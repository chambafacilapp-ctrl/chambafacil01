<!doctype html>
<html lang="es" class="scroll-smooth">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Chamba Fácil — Encuentra y ofrece oficios cerca de ti</title>
  <meta name="description" content="Marketplace local de oficios y servicios: publica tu perfil y conecta por WhatsApp.">
  <meta name="theme-color" content="#f97316">
  <link rel="manifest" href="/manifest.webmanifest">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { colors: { primary: {50:'#fff7ed',500:'#f97316',600:'#ea580c',700:'#c2410c'} } } } }
  </script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore-compat.js"></script>
  <script>
    // Rellena con TU configuración de Firebase
    const FIREBASE_CONFIG = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "SENDER_ID",
      appId: "APP_ID"
    };
    let db = null;
    try { if (FIREBASE_CONFIG.apiKey !== "YOUR_API_KEY") { firebase.initializeApp(FIREBASE_CONFIG); db = firebase.firestore(); } } catch(e){}
  </script>

  <!-- Cloudinary: solo para mostrar imágenes -->
  <script>
    const CLOUDINARY_CLOUD_NAME = "demo"; // cambia por tu cloud_name
    function cldImg(id,w=640){ return `https://res.cloudinary.com/${CLOUDINARY_CLOUD_NAME}/image/upload/f_auto,q_auto,w_${w}/${id}.jpg`; }
    function cldSrcSet(id){ return [320,480,640,960,1200].map(w=>`${cldImg(id,w)} ${w}w`).join(','); }
  </script>
</head>
<body class="antialiased text-slate-800 pb-16 md:pb-0">
  <!-- Header -->
  <header class="fixed inset-x-0 top-0 z-50">
    <div class="mx-auto container px-4">
      <div class="mt-4 mb-3 flex items-center justify-between rounded-2xl bg-white/70 backdrop-blur px-4 py-3 shadow">
        <a href="#inicio" class="flex items-center gap-2 font-semibold"><span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-primary-600 text-white">CF</span> Chamba Fácil</a>
        <nav class="hidden gap-6 md:flex">
          <a href="#oficios" class="hover:text-primary-600">Oficios</a>
          <a href="#precios" class="hover:text-primary-600">Planes</a>
          <a href="#pagos" class="hover:text-primary-600">Pagos</a>
          <a href="#contacto" class="hover:text-primary-600">Contacto</a>
        </nav>
        <a href="https://wa.me/524434813662" class="hidden md:inline-block rounded-xl bg-primary-600 px-4 py-2 text-white">WhatsApp</a>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section id="inicio" class="pt-40">
    <div class="mx-auto container px-4 grid gap-8 md:grid-cols-2 items-center">
      <div>
        <h1 class="text-4xl font-extrabold">Conecta con clientes y oficios locales con <span class="text-primary-600">Chamba Fácil</span></h1>
        <p class="mt-4 text-slate-600">Publica tu perfil, recibe mensajes por WhatsApp y encuentra profesionales cercanos.</p>
        <div class="mt-6 flex gap-3">
          <a href="#pagos" class="rounded-xl bg-primary-600 px-6 py-3 text-white">Registrar mi oficio</a>
          <a href="#oficios" class="rounded-xl border px-6 py-3">Buscar oficios</a>
        </div>
      </div>
      <img class="rounded-3xl shadow" src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=1600&auto=format&fit=crop" alt="mockup">
    </div>
  </section>

  <!-- Directorio -->
  <section id="oficios" class="py-16 bg-slate-50">
    <div class="mx-auto container px-4">
      <h2 class="text-3xl font-bold text-center">Oficios</h2>
      <div class="mt-6 flex items-center justify-between">
        <span id="page-label" class="text-sm text-slate-600">Cargando...</span>
        <div class="flex gap-2">
          <button id="prev-btn" class="rounded-xl border px-3 py-2 disabled:opacity-40" disabled>Anterior</button>
          <button id="next-btn" class="rounded-xl border px-3 py-2">Siguiente</button>
        </div>
      </div>
      <div id="profiles-list" class="mt-6 grid gap-6 sm:grid-cols-2 md:grid-cols-3"></div>
    </div>
  </section>

  <!-- Planes -->
  <section id="precios" class="py-16">
    <div class="mx-auto container px-4">
      <h2 class="text-3xl font-bold text-center">Planes</h2>
      <div class="mt-8 grid gap-6 md:grid-cols-3">
        <div class="rounded-2xl border p-6"><p class="text-sm text-primary-600">Básico</p><h3 class="text-4xl font-extrabold">$4,990</h3><a href="#pagos" class="mt-4 inline-block rounded-xl bg-slate-900 px-4 py-2 text-white">Elegir</a></div>
        <div class="rounded-2xl border p-6 ring-2 ring-primary-600"><p class="text-sm text-primary-600">Profesional</p><h3 class="text-4xl font-extrabold">$9,990</h3><a href="#pagos" class="mt-4 inline-block rounded-xl bg-primary-600 px-4 py-2 text-white">Elegir</a></div>
        <div class="rounded-2xl border p-6"><p class="text-sm text-primary-600">Avanzado</p><h3 class="text-4xl font-extrabold">$17,990</h3><a href="#pagos" class="mt-4 inline-block rounded-xl bg-slate-900 px-4 py-2 text-white">Elegir</a></div>
      </div>
    </div>
  </section>

  <!-- Pagos -->
  <section id="pagos" class="py-16 bg-slate-50">
    <div class="mx-auto container px-4">
      <h2 class="text-3xl font-bold text-center">Portal de pagos</h2>
      <p class="mt-2 text-center text-slate-600">Transferencia (SPEI), OXXO y PayPal.</p>

      <div class="mt-8 grid gap-6 md:grid-cols-3">
        <!-- SPEI -->
        <div class="rounded-2xl border p-6 bg-white">
          <h3 class="text-xl font-semibold">Transferencia (SPEI)</h3>
          <p class="mt-2 text-sm text-slate-600">Realiza transferencia y envía tu comprobante.</p>
          <div class="mt-3 text-sm">
            <p><strong>Banco:</strong> Banorte</p>
            <p><strong>Beneficiario:</strong> Eduardo Díaz Sánchez</p>
            <p><strong>CLABE:</strong> 072215006149433481
              <button type="button" class="ml-2 rounded border px-2 py-0.5 text-xs"
                onclick="navigator.clipboard.writeText('072215006149433481')">Copiar</button></p>
            <p><strong>Concepto:</strong> Suscripción Chamba Fácil</p>
          </div>
          <form action="https://formsubmit.co/chambafacil8@gmail.com" method="POST" enctype="multipart/form-data" class="mt-3 grid gap-2">
            <input type="hidden" name="_subject" value="Comprobante de pago — Transferencia">
            <input type="hidden" name="_captcha" value="false">
            <input type="text" name="nombre" required placeholder="Tu nombre" class="rounded-xl border px-3 py-2">
            <input type="email" name="email" required placeholder="Tu correo" class="rounded-xl border px-3 py-2">
            <input type="file" name="comprobante" accept="image/*,application/pdf" class="rounded-xl border px-3 py-2">
            <button class="rounded-xl bg-primary-600 px-4 py-2 text-white hover:bg-primary-700">Enviar comprobante</button>
          </form>
        </div>

        <!-- OXXO / MP -->
        <div class="rounded-2xl border p-6 bg-white">
          <h3 class="text-xl font-semibold">Pago en OXXO</h3>
          <p class="mt-2 text-sm text-slate-600">Se generará una referencia por Mercado Pago.</p>
          <div class="flex flex-col gap-2 mt-3">
            <button onclick="pagar('basic')" class="rounded-xl bg-primary-600 px-4 py-2 text-white">Básico (MP)</button>
            <button onclick="pagar('professional')" class="rounded-xl bg-primary-600 px-4 py-2 text-white">Profesional (MP)</button>
            <button onclick="pagar('advanced')" class="rounded-XL bg-primary-600 px-4 py-2 text-white">Avanzado (MP)</button>
          </div>
        </div>

        <!-- PayPal -->
        <div class="rounded-2xl border p-6 bg-white">
          <h3 class="text-xl font-semibold">PayPal</h3>
          <div id="paypal-button-container" class="mt-3"></div>
          <p class="mt-2 text-xs text-slate-500">*Modo sandbox (client-id=sb). Cambia a producción cuando tengas tu cuenta.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contacto -->
  <section id="contacto" class="py-16">
    <div class="mx-auto container px-4 grid gap-10 md:grid-cols-2">
      <div>
        <h2 class="text-3xl font-bold">Contacto</h2>
        <p class="mt-2 text-slate-600">Email: chambafacil8@gmail.com · Tel: +52 443 481 3662</p>
        <a href="https://wa.me/524434813662" class="mt-4 inline-block rounded-xl bg-green-600 px-5 py-3 text-white">WhatsApp</a>
      </div>
      <form action="https://formsubmit.co/chambafacil8@gmail.com" method="POST" class="rounded-2xl border bg-white p-6">
        <input type="hidden" name="_subject" value="Nuevo lead — Chamba Fácil">
        <input type="hidden" name="_captcha" value="false">
        <div class="grid gap-3">
          <input class="rounded-xl border px-3 py-2" name="nombre" placeholder="Nombre" required>
          <input class="rounded-xl border px-3 py-2" name="email" type="email" placeholder="Email" required>
          <textarea class="rounded-xl border px-3 py-2" name="mensaje" rows="4" placeholder="¿Qué necesitas?"></textarea>
          <button class="rounded-xl bg-primary-600 px-5 py-3 text-white">Enviar</button>
        </div>
      </form>
    </div>
  </section>

  <footer class="border-t py-10">
    <div class="mx-auto container px-4 flex items-center justify-between">
      <p class="text-sm">© <span id="year"></span> Chamba Fácil.</p>
      <nav class="text-sm"><a href="/politica.html" class="hover:text-primary-600">Aviso de privacidad</a> · <a href="/terminos.html" class="hover:text-primary-600">Términos</a></nav>
    </div>
  </footer>

  <script>document.getElementById('year').textContent = new Date().getFullYear();</script>

  <!-- Mercado Pago SDK -->
  <script src="https://sdk.mercadopago.com/js/v2"></script>
  <script>
    // Reemplaza por tu Public Key de Mercado Pago
    const mp = new MercadoPago('PUBLIC_KEY_PLACEHOLDER', { locale: 'es-MX' });
    async function pagar(plan){
      const res = await fetch('/api/create-preference', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ plan })});
      const data = await res.json();
      if (data?.init_point || data?.sandbox_init_point) {
        location.href = data.init_point || data.sandbox_init_point;
      } else {
        alert('No se pudo crear la orden');
      }
    }
  </script>

  <!-- PayPal Sandbox -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=MXN"></script>
  <script>
    if (window.paypal) {
      paypal.Buttons({
        createOrder: (_, actions) => actions.order.create({
          purchase_units: [{ amount: { value: '999.00', currency_code: 'MXN' }, description: 'Suscripción anual Chamba Fácil' }]
        }),
        onApprove: (_, actions) => actions.order.capture().then(() => alert('Pago PayPal completado.'))
      }).render('#paypal-button-container');
    }
  </script>

  <script>
    const PAGE_SIZE = 12; let page=1;
    const FALLBACK = Array.from({length:24}).map((_,i)=>({name:`Oficio ${i+1}`, oficio:'Varios', ciudad:'Morelia', photos:['sample'], rating:4.5}));
    function renderSlice(items){
      const list=document.getElementById('profiles-list');
      list.innerHTML = items.map(p=>{
        const img=p.photos?.[0]||'sample';
        return `<article class='rounded-2xl border overflow-hidden bg-white'>
          <img loading='lazy' class='h-48 w-full object-cover' src='${cldImg(img,640)}' srcset='${cldSrcSet(img)}' sizes='(max-width:640px) 100vw, 33vw' alt='${p.oficio||'Oficio'}'>
          <div class='p-4'><h3 class='font-semibold'>${p.name||'Perfil'}</h3>
          <p class='text-sm text-slate-600'>${p.oficio||''} · ${p.ciudad||''}</p>
          <a href='https://wa.me/524434813662' class='mt-3 inline-block rounded-xl bg-primary-600 px-3 py-2 text-white'>Contactar</a></div></article>`
      }).join('');
    }
    async function loadPage(){
      if (db){
        const ref = db.collection('profiles').orderBy('createdAt','desc').limit(PAGE_SIZE);
        const snap = await ref.get();
        renderSlice(snap.docs.map(d=>d.data()));
        document.getElementById('page-label').textContent = 'Firestore (últimos perfiles)';
        document.getElementById('prev-btn').disabled = true;
        document.getElementById('next-btn').disabled = true;
      } else {
        const start=(page-1)*PAGE_SIZE;
        const slice=FALLBACK.slice(start,start+PAGE_SIZE);
        renderSlice(slice);
        document.getElementById('page-label').textContent = `Página ${page} de ${Math.ceil(FALLBACK.length/PAGE_SIZE)}`;
        document.getElementById('prev-btn').disabled = page<=1;
        document.getElementById('next-btn').disabled = page>=Math.ceil(FALLBACK.length/PAGE_SIZE);
      }
    }
    document.getElementById('prev-btn').onclick=()=>{page--;loadPage();};
    document.getElementById('next-btn').onclick=()=>{page++;loadPage();};
    window.addEventListener('DOMContentLoaded', loadPage);
  </script>
</body>
</html>
